---
title: 'The Role of Social Distance in Surrogate Decision Making Involving Risks'
author: Eva Wu
output: 
  github_document:
    toc: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(here)
library(knitr)
library(rstatix)
library(ggpubr)
```

## Data Cleaning

```{r import}
decision_data <- read_csv(here('decision-making.csv'))  # preserve a copy of the original data frame

cleaned_data <- decision_data[-c(1, 2), ] %>%      # delete first 2 rows of irrelevant info
  select(-(StartDate:IC), -Name_FMF, -Name_FSF,    # delete irrelevant columns
         -Gender_FMF, -Gender_FSF, -Gender_StMF, 
         -Gender_StSF, -(SC1:SC2)) %>%
  filter(!is.na(id)) %>%              # delete participants who left everything blank (only 1)
  mutate_if(is.character, as.numeric) # when imported, all variables were defined as characters for some reason; 
                                      # this code is to change chr into double (learned from stackoverflow)
```

```{r tidy}
# M1-M4, S1-S4 are 4 monetary and 4 safety scenarios respectively. Participants' answers were binary, 
# with 1 indicating the risk-averse choices, while 2 indicating the risk-taking choices. Since there 
# were 6 conditions, participants' responses were spread across 6 separate columns. The following 
# code aims to combine their answers to the each question into the same column (e.g., M1_SeMF, 
# M1_SeSF, M1_FMF, etc., into the same column "M1"). 

# Since each participants only responded to questions from one condition, their answers to questions 
# from other conditions were coded as NA. I used the rowSums function to calculate the sum of each row, 
# which moves participants' answers to the new columns. E.g., participants in the SeMF condition (deciding for self, 
# monetary scenarios first) only has answers to the M1_SeMF, M2_SeMF, etc.,and the rowSums 
# function moves their answers to the new column, since their answers to M1_FMF, M1_StSF, etc. are 0.

# create a vector for new column names
new_cols <- c('M1', 'M2', 'M3', 'M4', 'S1', 'S2', 'S3', 'S4')

# create a loop to do the same operation 8 times; this chunk could only be run once per session or the data will be messed up
for(i in seq_along(new_cols)){
  df_selected <- select(cleaned_data, starts_with(new_cols[i]))   # select columns with names starting with "M1, M2...S4"
  cleaned_data[new_cols[i]] <- rowSums(df_selected - 1, na.rm = TRUE)   # add na.rm = TRUE to make NA count as 0
}                                # here we did "-1" to code responses as 0 and 1 rather than 1 and 2
```

```{r combine}
# create separate columns for MTotal (total number of risky choices in the monetary domain) and 
# STotal (total number of risky choices in the safety domain)
combined_data <- cleaned_data %>%
  mutate(MTotal = M1 + M2 + M3 + M4) %>%
  mutate(STotal = S1 + S2 + S3 + S4) %>%
  mutate(Recipient_chr = case_when(Recipient == '1' ~ 'Self',
                                   Recipient == '2' ~ 'Friend',
                                   Recipient == '3' ~ 'Stranger'),
         .before = MTotal) %>%    # specify position of the mutated column
  select(id, Sex, Age, Recipient, Recipient_chr, MTotal, STotal) %>% # rearrange columns 
  mutate(Sex = case_when(Sex == 1 ~ 'Male', Sex == 2 ~ 'Female')) 

combined_data
```

This shows the my dataset in a nutshell. Each participant has a unique "id" generated by Qualtrics. Each row has data for one participant. "Recipient" stands for whom participants were deciding for, and was coded as numeric values, with 1 meaning self, 2 meaning friend, while 3 meaning stranger (a typical student at Wake Forest University). I created a "Recipient_chr" column to recode "Recipient" into strings. MTotal stands for the total number of riskier choices in the monetary domain, while STotal stands for the total number of riskier choices in the safety domain. Both MTotal and STotal range from 0 to 4, with 0 meaning the participant chose the safer option throughout, while 4 meaning the participant chose the riskier option throughout.

```{r pivot}
# Here I combined MTotal and STotal into a single column "Risk-taking" using pivot_longer. Since domain is a within-subject IV, each participant will have 2 rows of data, one row for monetary domain and another row for safety domain.
pivoted_data <- combined_data %>%
  pivot_longer(c(MTotal, STotal), names_to = 'Domain', values_to = 'Risk-taking') %>%
  mutate(Domain = if_else(Domain == 'MTotal', 'Monetary', 'Safety'))  
  # if Domain == 'MTotal', change into 'Monetary', else change into 'Safety'
```

## Descriptives

```{r descriptives}
# calculate mean & sd of the level of risk-taking in monetary and safety scenarios respectively, regardless of decision recipient
total_mean <- combined_data %>%
  summarise(mean_M = mean(MTotal, na.rm = TRUE), sd_M = sd(MTotal, na.rm = TRUE), 
            mean_S = mean(STotal, na.rm = TRUE), sd_S = sd(STotal, na.rm = TRUE)) %>%
  mutate(Recipient = 'Total', .before = mean_M)    # define position of new column

# calculate mean & sd after grouping by recipient
descriptives <- combined_data %>%
  group_by(Recipient) %>%
  summarise(mean_M = mean(MTotal, na.rm = TRUE), sd_M = sd(MTotal, na.rm= TRUE),
            mean_S = mean(STotal, na.rm = TRUE), sd_S = sd(STotal, na.rm = TRUE))

# combine the total mean & mean of each group into the same data frame
binded_data <- rbind(descriptives, total_mean)

# create a kable table for descriptives (mean & sd)
presented_data <- binded_data %>%
  mutate(Recipient_chr = case_when(Recipient == '1' ~ 'Self',
                                   Recipient == '2' ~ 'Friend',
                                   Recipient == '3' ~ 'Stranger',
                                   Recipient == 'Total' ~ 'Total')) %>%
  rename(Recipient_dbl = Recipient) %>%       # rename(new = old) is the syntax to change column names
  rename(`Mean Monetary` = mean_M, `SD Monetary` = sd_M, 
         `Mean Safety` = mean_S, `SD Safety` = sd_S,
         Recipient = Recipient_chr)

presented_data %>%
  select(Recipient, `Mean Monetary`, `SD Monetary`, `Mean Safety`, `SD Safety`) %>%
  kable(caption = 'Table 1. Descriptive Statistics')

# I later found out an easier way to do this, using a new package - 
# combined_data %>% get_summary_stats(MTotal, STotal, type = 'mean_sd')
```

This table shows the mean and standard deviation of each group. Both "Mean Monetary" and "Mean Safety" range from 0 to 4, with 0 indicating no riskier choices made, while 4 indicating no safer choices made. The greater the value, the higher level of risk-taking. The "Total" row shows the mean and standard deviation of risk-taking in the monetary and safety domains regardless of decision recipient.

## Exploratory Data Analysis

### Gender Distribution

```{r sex}
combined_data %>%
  group_by(Sex) %>%
  summarise(count = n()) %>%
  filter(Sex != 'NA') %>%
  ggplot(aes(Sex, count)) +
  geom_col(fill = 'orange') +
  labs(x = 'Gender of participants', y = 'Number of participants', 
       title = 'Fig. 1. Gender distribution among participants') +
  theme_minimal()
```

As shown in Fig. 1, the number of male and female participants in this study were approximately the same.

### Age Distribution

```{r age}
combined_data %>%
  ggplot(aes(Age)) +
  geom_histogram(fill = 'pink') +
  labs(x = 'Age of participants', y = 'Number of participants', 
       title = 'Fig. 2. Age distribution among participants') +
  theme_minimal()
```

As shown in Fig. 2, the age of participants ranged from 18 to 23. Most participants were at the age of 19. Very few were above 22. This might be due to the fact that students in Introductory Psychology were mostly freshmen or sophomores.

### Risk-taking by Gender

```{r sex_risk}
pivoted_data %>%
  group_by(Sex, Domain) %>%
  summarise(`Risk-taking` = mean(`Risk-taking`)) %>%
  filter(Sex != 'NA') %>%
  ggplot(aes(Sex, `Risk-taking`, fill = Domain)) +
  geom_col(position = 'dodge') +
  labs(x = 'Gender', title = 'Fig. 3. Risk-taking by gender') +
  theme_minimal()
```

As shown in Fig. 3, it seems that for both monetary and safety domains, females were a little more risk-taking than males.

### Risk-taking by Recipient and Domain

```{r line graph}
presented_data %>%
  filter(Recipient != 'Total') %>%
  mutate(Recipient_dbl = as.numeric(Recipient_dbl)) %>%
  ggplot() +
  geom_line(aes(reorder(Recipient, Recipient_dbl), `Mean Monetary`, color = 'Monetary'), group = 1) +   
  # add group = 1 b/c otherwise nothing will show up
  geom_line(aes(reorder(Recipient, Recipient_dbl), `Mean Safety`, color = 'Safety'), group = 1) +
  labs(x = 'Decision Recipient', y = 'Risk-taking', 
       title = 'Fig. 4. Risk-taking by recipient and domain', color = 'Domain') +
  theme_minimal()
```

This line graph compares the mean level of risk-taking across recipients and domains. The red line represents the monetary domain, while the green line represents the safety domain. As shown in Fig. 4, in the monetary scenarios, participants made riskier decisions for their friends than for stranger than for self. However, in the safety scenarios, it was the reverse – participants made more risk-averse decisions for their friends than for stranger than for self. This plot is for exploratory data analysis. Since there's an interesting trend, I performed an ANOVA test below to see which relationships were significant.

## Check ANOVA Assumptions

### Outliers 

```{r identify_outliers, include = FALSE}
pivoted_data %>%
  group_by(Recipient, Domain) %>%
  identify_outliers(`Risk-taking`) 

ggplot(pivoted_data, aes(reorder(Recipient_chr, Recipient), `Risk-taking`, color = Domain)) +
  geom_boxplot() +
  labs(x = 'Decision Recipient', y = 'Risk-taking', 
       title = 'Fig. 5. Risk-taking Boxplot by Recipient and Domain')
```

There are 5 outliers, but none of them was extreme, so I left them as is.

### Normality

```{r normality}
# violated but fine
shapiro.test(pivoted_data$`Risk-taking`)

ggqqplot(pivoted_data, "Risk-taking", ggtheme = theme_bw()) +
  facet_grid(Recipient_chr ~ Domain, labeller = "label_both")
```

### Homogeneity of variance

```{r homoscedasticity}
pivoted_data %>% levene_test(`Risk-taking` ~ Recipient_chr*Domain)
# sphericity violated but corrected w/ GG
```

It's OK that these assumptions were violated, because our sample was large and balanced, and we will use Greenhouse Geisser correction in our ANOVA results.

## Two-way Mixed Analysis of Variance (ANOVA)

```{r anova}
kable(get_anova_table(anova_test(
  data = pivoted_data,
  dv = `Risk-taking`,
  wid = id,
  between = Recipient,
  within = Domain)), caption = 'Table 2. ANOVA results')
```

Results from a two-way repeated-measures factorial ANOVA showed a significant main effect of decision domain on participants’ risk taking, as compared between the monetary domain (*M* = 1.79, *SD* = 1.27) and the safety domain (*M* = 0.65, *SD* = 0.82). On average, people were more risk-taking in the monetary than safety domain, *F*(1, 282) = 174.95, *p* < .001. Results from a two-way repeated-measures factorial ANOVA showed no significant main effect of social distance on participants’ risk-taking, as compared among those who decided for themselves, those who decided for their friend, as well as those who decided for a typical student on campus, *F*(2, 282) = 0.09, *p* = .91. Those who made decisions for themselves, their friend, and a typical student had no difference in risk taking while making their decisions. There was a significant interaction between social distance and decision domain, *F*(2, 282) = 10.67, *p* < .001. The trend is demonstrated in Fig. 4.

## Conclusions

In this assignment, I first imported data that I collected, tidied the data frame, and presented a kable table of the descriptives. Then, I performed some exploratory data analyses with regards to gender, age, domain, recipient, and risk-taking. Then I checked for outliers, performed ANOVA test. From evidence presented in this study, I concluded that people were more risk-taking in the monetary than safety domain, and that people made the most risky decisions for their friends in the monetary domain and for themselves in the safety domain, but the most risk-averse decisions for their friends in the safety domain and for themselves in the monetary domain. More to explore in the future!

## Session info

```{r session info}
devtools::session_info()
```